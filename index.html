<script>
  /***** i18n *****/
  const i18n = {
    en: {
      'boot.init':'INITIATE SYSTEM [ N.E.V.O. ]',
      'boot.load':'LOADING MODULES…',
      'boot.status':'STATUS: ONLINE',
      'boot.hint':'HINT: Use toolbar or press ENTER',
      'boot.navigate':'HINT: Use toolbar or press 1-7 to navigate',
      'intro.title':'INITIATE SYSTEM [ N.E.V.O. ]',
      'intro.p':'N.E.V.O. is my longing to exist and resist — poetically, musically, investigatively, and artistically-professionally.'
    },
    es: {
      'boot.init':'INICIAR SISTEMA [ N.E.V.O. ]',
      'boot.load':'CARGANDO MÓDULOS…',
      'boot.status':'ESTADO: EN LÍNEA',
      'boot.hint':'PISTA: Usa la barra o presiona ENTER',
      'boot.navigate':'PISTA: Usa la barra o presiona 1-7 para navegar',
      'intro.title':'INICIAR SISTEMA [ N.E.V.O. ]',
      'intro.p':'N.E.V.O. es mi anhelo de existir y resistir — poéticamente, musicalmente, investigativamente y profesional-artísticamente.'
    }
  };

  /***** idioma (arreglo de precedencia) *****/
  const storedLang = localStorage.getItem('nevo_lang');
  const browserLang = ((navigator.language || 'en').startsWith('es')) ? 'es' : 'en';
  let curLang = storedLang ? storedLang : browserLang;

  /***** refs DOM *****/
  const langButtons = { en: document.getElementById('langEN'), es: document.getElementById('langES') };
  const themeBtns = {
    rudy: document.getElementById('btnRudy'),
    raver: document.getElementById('btnRaver'),
    col: document.getElementById('btnCol')
  };
  const bootEl = document.getElementById('bootLines');     // << definido ANTES de llamarlo
  const enterBtn = document.getElementById('enterBtn');
  const luckyBtn = document.getElementById('luckyBtn');

  /***** util: activar secciones *****/
  function activate(id){
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
    const el = document.querySelector(id);
    if (el){ el.classList.add('active'); el.focus(); }
    document.querySelectorAll('button[data-target]').forEach(b=>{
      b.setAttribute('aria-pressed', b.dataset.target === id ? 'true' : 'false');
    });
    if (history.replaceState) history.replaceState({},'',id);
  }

  /***** render boot lines (traducidas) *****/
  function renderBootLines(){
    if (!bootEl) return;
    const L = i18n[curLang];
    bootEl.innerHTML = `${L['boot.init']}\n${L['boot.load']}\n${L['boot.status']}\n${L['boot.navigate']}`.replace(/\n/g,'<br>');
  }

  /***** setLang (ya puede llamar renderBootLines sin error) *****/
  function setLang(lang){
    curLang = lang;
    localStorage.setItem('nevo_lang', lang);
    if (langButtons.en) langButtons.en.setAttribute('aria-pressed', String(lang==='en'));
    if (langButtons.es) langButtons.es.setAttribute('aria-pressed', String(lang==='es'));
    document.querySelectorAll('[data-i18n]').forEach(el=>{
      const k = el.getAttribute('data-i18n');
      const v = i18n[lang][k];
      if (v) el.textContent = v;
    });
    renderBootLines();
  }

  /***** listeners idioma *****/
  langButtons.en && langButtons.en.addEventListener('click',()=> setLang('en'));
  langButtons.es && langButtons.es.addEventListener('click',()=> setLang('es'));

  /***** temas (persistentes) *****/
  const themeKey='nevo_theme';
  function setTheme(t){
    document.body.classList.remove('theme-rudy','theme-raver','theme-col');
    document.querySelectorAll('.theme button').forEach(b=>b.setAttribute('aria-pressed','false'));
    if (t){
      document.body.classList.add(t);
      localStorage.setItem(themeKey, t);
      const map = { 'theme-rudy': themeBtns.rudy, 'theme-raver': themeBtns.raver, 'theme-col': themeBtns.col };
      map[t] && map[t].setAttribute('aria-pressed','true');
    }
  }
  themeBtns.rudy && themeBtns.rudy.addEventListener('click', ()=> setTheme('theme-rudy'));
  themeBtns.raver && themeBtns.raver.addEventListener('click', ()=> setTheme('theme-raver'));
  themeBtns.col && themeBtns.col.addEventListener('click', ()=> setTheme('theme-col'));

  /***** restaurar estado *****/
  const savedTheme = localStorage.getItem(themeKey);
  if (savedTheme) setTheme(savedTheme);
  setLang(curLang);           // << ahora seguro: bootEl ya existe y renderBootLines también

  /***** tecla ENTER → /intro *****/
  enterBtn && enterBtn.addEventListener('click', ()=> activate('#intro'));
  window.addEventListener('keydown', (e)=>{
    if (e.key==='Enter' && document.querySelector('#landing.section.active')) activate('#intro');
    const n = parseInt(e.key, 10);
    const map = ['#landing','#intro','#nevo','#nebo','#jsgm','#manifesto','#contact'];
    if (n>=1 && n<=7) activate(map[n-1]);
  });

  /***** lucky: diagnóstico musicofílico *****/
  luckyBtn && luckyBtn.addEventListener('click', ()=>{
    const song = prompt(curLang==='es' ? '¿Última canción que escuchaste?' : 'Last song you listened to?');
    if(!song) return;
    const dx = ['rhythmic pattern-seeker','latency-immune groove rider','affect-driven selector','tempo shifter','texture diver','syncopation chaser','resonance mapper'];
    const pick = dx[Math.floor(Math.random()*dx.length)];
    alert((curLang==='es' ? 'Diagnóstico musicofílico: ' : 'Musicophilia dx: ') + pick + '\n' + (curLang==='es' ? 'Entrada registrada para futuras curadurías.' : 'Logged for future curation.'));
  });

  /***** toolbar nav *****/
  document.querySelectorAll('button[data-target]').forEach(b=>{
    b.addEventListener('click', e=>{ e.preventDefault(); activate(b.dataset.target); });
  });

  /***** escena tipo “terminal te habla” en /intro *****/
  (function(){
    const sceneEl = document.getElementById('sceneLine');
    if (!sceneEl) return;
    const sceneLines = ['> Wake up, NEVO.','> Follow the signal.','> The archive is alive.','> Press ENTER.'];
    let i=0; (function step(){ if(i>=sceneLines.length) return; sceneEl.textContent = sceneLines[i++]; setTimeout(step,700); })();
  })();

  /***** manifiesto: auto-typing loop *****/
  (function(){
    const manEl = document.getElementById('manText');
    if (!manEl) return;
    const copy = "N.E.V.O. is not spectacle. Not mere entertainment. It is a living archive: an open space where music, words and memory activate together! Alternative, disruptive, empathetic.\nThis is Nevo, prosing as Nebo. I am transit and creation. I am the new longevous.";
    let ti=0, dir=1;
    (function loop(){ manEl.textContent = copy.slice(0,ti) + (ti%3===0?'_':''); ti+=dir; if(ti>=copy.length+3) dir=-1; if(ti<=0) dir=1; setTimeout(loop, 40); })();
  })();

  /***** Year *****/
  (function(){ const y=document.getElementById('year'); if(y) y.textContent=new Date().getFullYear(); })();

  /***** Dig panels (/nevo) *****/
  function openDig(which){
    const notes = {
      afflictions:'Restless rhythms; industrial textures; border tempos. The ache is the engine.',
      inclinations:'138–145 BPM lanes; drum workouts; syncopated lows; sudden silences.',
      explorations:'Local scenes × club tools; ska-punk memories remapped to warehouse pressure.',
      landscapes:'Bogotá nights; Andean winds; street vendors at dawn; friends who kept the light on.'
    };
    alert('/'+which+'\n'+(notes[which]||''));
  }
  window.openDig = openDig;
</script>
